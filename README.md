# Stellaris Dashboard

Stellaris currently does not have a timeline feature that shows some statistics and historical info, so I decided to build this project to provide in-depth information within the game.

Here is a one minute animation of the interactive dashboard in-game:

https://gfycat.com/RealAnguishedAustralianfreshwatercrocodile

Alternatively, you can export static images:

https://imgur.com/a/4dhVd

The program runs in the background and reads the autosave files as they are generated by the game. It extracts the information and compiles it into a database, which is then used to visualize your progress.

So far, the dashboard shows information about:

  - Economy: detailed categorized energy, mineral and food budgets (categories include production, sector income, trade, ship and pop maintenance, enclave trade deals...)
  - Science: number of techs, research output, exploration (number of surveyed objects)
  - Population: number of pops, species demographics
  - Factions: size, support and happiness of each faction
  - Military: fleet strength

To maintain your immersion, only information which is reasonable for you to have is shown, so you can only see the fleet power of empires who are friendly, or who have given you active sensor links or defensive pacts. 
However, you can configure a cheat mode which shows everything.

The dashboard completely ignores saves from Multiplayer and Ironman mode, so it will only work for casual games. 

Also note that it does not always handle reloading of older save games very well, and may fail to overwrite data if no new save file is generated. Or you may end up with data that is a mix of all your save-reloading cycles. I recommend treating the playthrough a bit like Ironman mode: Just see what happens and go with it... :-)

# Installation and Use

## Prerequisites

The Stellaris dashboard requires Python 3.6 or later, which you can download and install for your platform (Windows, Mac or Linux) from https://www.python.org/. 

If you are using Windows, make sure to check the "Add Python 3.6 to PATH" option (or similar) in the installer.

## Installation

  1. Download and extract this repository. (Click the green "Clone or Download" button above and select "Download ZIP")
  2. Install the `stellarisdashboard` program:
     - Windows users: 
     
       You can follow the detailed steps described for Linux users below, or use the simple method that does most of the work for you:
          1. Run the `install.bat` file in the extracted folder by double-clicking it.
          2. To start the program, run the `stellarisdashboard.bat` file.
          
       If you use this method and later want to use the more advanced commands from the command line interface (CLI) described below, you will then have to:
          1. Open a command line in the extracted folder
          2. Activate the virtual environment that is automatically created by `install.bat` using the command `env\Scripts\activate`
          3. Run your CLI command, i.e. execute `python -m stellarisdashboard.cli <your-command-here>`.
          
     - Linux / Mac users: 
     
       Ensure that you are using python 3.6 when running the commands below. You likely have other python versions installed on your system already.
     
          1. Open a terminal in the extracted folder.
          2. (Optional) Create and activate a virtual environment by running e.g. `python3.6 -m venv env`, followed by `. env/bin/activate`. This avoids interference with any other python programs.
          3. Open a terminal in the downloaded directory and run `pip3.6 install -e .` to install the program using pip. This should take care of all dependencies and allow you to run the program from anywhere. The `-e` flag tells pip to link to the the python code where it is instead of copying it to another location, which might be confusing for editing your `config.ini` file.
          4. Alternatively, use `pip install -r requirements.txt` to only install the dependencies, or install them manually. In this case, you can use `python -m stellarisdashboard` from the `src/` folder.
  3. To use the interactive dashboard in-game, either subscribe to the browser-mod [in the Steam Workshop](http://steamcommunity.com/sharedfiles/filedetails/?id=1341242772) (maintained independently by Steam/reddit user 8igualdos0s), or copy the contents of the `mod/` folder into your Stellaris mod folder. Enable the "Stellaris Dashboard Integration" mod in the game launcher.

Note: You may have to use `python -m pip` instead of `pip` if you use Windows and follow the detailed instructions yourself. In this case, just replace `pip` with `python -m pip` wherever necessary.
If this is the case, then you probably also have to use `python -m stellarisdashboard` and `python -m stellarisdashboard.cli` instead of `stellarisdashboard` and `stellarisdashboardcli`.

## Contributions

If you want to compile the Cython extensions and run the (currently minimal) unittest suite, you should install Cython and pytest. You can do this by running `pip -r dev-requirements.txt`. 

**Contributions are very welcome and appreciated!**

# Instructions

If you just want the basics, run the `stellarisdashboard` command while you play the game and it should do everything for you: If you installed the program in step 3 above, run `stellarisdashboard` in your command line to launch the dashboard in default configuration or `stellarisdashboardcli` to execute specific commands, which are described below.

While `stellarisdashboard`  is running, you can open the in-game browser with the help button in the lower right corner of the game UI, or by pressing the shortcut Alt-B. Then, there should be a big button with the galaxy icon in the top right corner of the browser window. Clicking this button (or the shortcut "T") should open the dashboard. Alternatively, you can use your regular web browser to view the dashboard at [the default address](http://127.0.0.1/28053) without installing the mod.

## Default Execution
The command `stellarisdashboard` reads the save files in the background and starts a local web server for the interactive dashboard. 

As the save files are processed in the background, the data is added to a database in your output folder. This database is named according to the game it represents.
Every file generated by the dashboard is saved in the output folder, which is by default `$USER/Documents/stellarisdashboard/`. Here, `$USER` is your user directory, which depends on your operating system.

You can access the visualizations while the dashboard is running, by either using a browser to go to `http://127.0.0.1:28053/`, or by using the included mod for the in-game browser. 

Note that the current method of reading the save files is a bit slow, so the graphs may lag behind the game quite a bit. You may have to wait up to a minute for the dashboard to catch up.

## Command Line Interface

The command line interface allows you to:

  - Only run the save monitoring without any interactivity. This only builds the database, which you can later visualize (`stellarisdashboardcli monitor_saves`)
  - Produce the static visualizations (`stellarisdashboardcli visualize`)
  - Reparse all existing files. Running `stellarisdashboard` or `stellarisdashboardcli monitor_saves` will ignore any existing save files,
  so sometimes it may be necessary to manually re-parse them. (`stellarisdashboardcli parse_saves`)

Any parameters provided to these commands override the values set in the `config.ini` file.

## Configuration

The following parameters can be specified in the `src/stellarisdashboard/config.ini` file:

  - `save_file_path`: The path where the save files are.
  - `base_output_path`: The path where any files generated by the dashboard end up. This includes the database and any images you generate with `stellarisdashboardcli visualize`.
  - `threads`: The number of concurrent processes that are used for reading save files. (Recommended: 2 or 3)
  - `colormap`: The colormap used when producing static images. A list of available values can be found here: https://matplotlib.org/examples/color/colormaps_reference.html
  - `port`:  The port where the interactive dashboard is served. If you change this, you should adapt the URL in the `mod/Timeline/interface/browser.gui` file accordingly.
  - `showeverything`: Set to `True` if you want to see the data of all empires.

Note: Only the `config.ini` file that is in the same directory as the `config.py` will be used. If you installed the program using `pip install .` without the `-e` flag, then this will probably be somewhere in `site-packages`.

# Hardware Requirements

The Hardware requirements depend on many factors:

  - how fast you play
  - the galaxy size
  - how frequently you generate autosaves (monthly, quarterly, yearly)
  - how often you pause the game. 

## CPU
If the dashboard cannot keep up, it will likely skip some saves as they are overwritten by the game and it will then miss some data points.

If you have a quad-core CPU or better, I suggest allowing 2 or 3 threads. By default, the dashboard uses about half of the available threads.

## Disk Space
As for disk space, the dashboard has a fairly small footprint. The database currently uses about 1 MB every ten years with monthly autosaves.
Each game's data is stored in a separate database in your output folder, so you can delete them individually if you wish. 

The game deletes the autosaves in a "rolling" manner, so only the most recent files are kept. If you plan a long game 
and want to be able to re-generate the database later, you need to continually backup the save files yourself. This can be done by
running a script that automatically copies them to another location or some backup program.

This uses much more disk space (~1 GB every 50 years of game time with monthly saves), but allows you to rebuild the full database at any point using 
`stellarisdashboardcli parse_saves --save-path path/to/your/save_backup`. 

# Bugs

Some known bugs:

  - the economic budget numbers might not exactly match with what is shown in-game. This is because the program misses many modifiers. However, most numbers should be close enough.
  - Sometimes the dashboard glitches and adds a line that crosses through most of the graphs. 
    This probably happens because different parts of the program interact with the database at the same time.
    When this happens, simply kill the program and start it again. Avoid this issue by being a bit patient with the refresh button.
  - The food budget does not match the in-game numbers exactly when sectors are involved. It probably won't deviate too far. This is hard to fix because food is only shown as an integer value in-game.
  

The program should be fairly stable, but if something weird happens, just restart it!

# Acknowledgements

Thanks to [this project](https://github.com/omiddavoodi/StellarisInGameLedger) by reddit user Ariestinak, which inspired the 
approach of modding the in-game browser!

Also thanks to reddit and Steam user 8igualdos0s for maintaining a copy of the browser mod [in the Steam Workshop.](http://steamcommunity.com/sharedfiles/filedetails/?id=1341242772)
