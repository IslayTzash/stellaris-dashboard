# Stellaris Dashboard

Stellaris currently does not have a timeline feature that shows some statistics and historical info, so I decided to make this project to show more information within the game.

## Graphical Timeline Dashboard

Here is a one minute animation of the interactive dashboard:

https://gfycat.com/RealAnguishedAustralianfreshwatercrocodile

You can also export static images:

https://imgur.com/a/4dhVd

So far, the dashboard shows information about:

  - Economy: detailed categorized energy, mineral and food budgets (categories include production, sector income, trade, ship and pop maintenance, enclave trade deals...)
  - Science: number of techs, research output, exploration (number of surveyed objects)
  - Population: number of pops, species demographics
  - Factions: size, support and happiness of each faction
  - Military: fleet strength
  - An interactive, historical galaxy map to show who owned which system 

## Event Ledger

The dashboard now also contains a textual ledger listing many historical events:

https://imgur.com/a/t6858co

Currently, this is a list of Wars with detailed combat logs, and for each of your leaders, a biography is generated that shows their lifetime achievements, including:

  - Government reforms
  - Ruler mandates and political activities (faction leadership)
  - Passed edicts, researched technologies, embraced traditions and ascension perks
  - Planet colonizations

There is a lot more that can be done with this

## How it works

The stellaris dashboard program runs in the background while you play the game and reads the autosave files as they are generated by the game. It extracts information about the state of the game and adds it to a database, which is then used to visualize your progress. The dashboard also runs a server which can be accessed in-game through the web browser integrated in Stellaris. Of course you can also use any other web browser to look at the dashboard.

To maintain your immersion, only information which is reasonable for you to have is shown, so you can only see the fleet power of empires who are friendly, or who have given you active sensor links or defensive pacts. If you want, you can also configure it to show data of every empire. 

Since with this configuration option, the dashboard allows you to see data like fleet strength of every empire, it is a huge competitive advantage. **For this reason, the dashboard completely ignores Multiplayer and Ironman games.**

Also note that it does not always handle reloading of older save games very well, and may fail to overwrite data if no new save file is generated. Or you may end up with data that is a mix of all your save-reloading cycles. And it may completely break the event ledger. Getting all the details and edge cases right for this scenario is far more work than I can or want to deal with, so I recommend treating the playthrough like Ironman mode: Just see what happens... :-)

The program should be fairly stable, but if something weird happens, first try to restart it! If you run into problems that don't go away after restarting, please let me know here on github or [contact me on reddit](https://www.reddit.com/u/blubblubblob).

# Installation and Use

## Prerequisites

The Stellaris dashboard requires Python 3.6 or later, which you can download and install for your platform (Windows, Mac or Linux) from https://www.python.org/. 


## Installation

### Windows
  1. Install Python 3.6 or later from https://www.python.org/. 
  ***Make sure to check the "Add Python 3.6 to PATH" option in the first step of the python installer!***
  1. Download the latest release at the [release page](https://github.com/eliasdoehne/stellaris-dashboard/releases)  (Click on "Download Source Code (zip)")
  2. Extract the archive in a location of your choice.
  3. Run the `install.bat` file in the extracted folder by double-clicking it. At this point, Windows may show you a security warning [like this](https://imgur.com/6PIZCmA). If so, click on "More Information" to unlock the "Run anyway" button.
  3. To use the interactive in-game dashboard, install the "Stellaris Dashboard Integration" mod. Do **either** of the following:
     1. Subscribe to the browser mod [in the Steam Workshop](http://steamcommunity.com/sharedfiles/filedetails/?id=1341242772) (maintained independently by Steam/reddit user 8igualdos0s)
     2. Or manually install it, it is included in the `mod` folder 
  4. To start the program, run the `stellarisdashboard.bat` file. A similar Windows security warning as before may appear.
  5. Start Stellars and enable the "Stellaris Dashboard Integration" mod in the game launcher. 
  6. Play the game!

      
If you want to use the advanced commands from the command line interface (CLI) described below, you will  have to:
  1. Open a command line and navigate to the extracted folder
  2. Activate the virtual environment that is automatically created by `install.bat` using the command `env\Scripts\activate`
  3. Run your CLI command, i.e. execute `python -m stellarisdashboard.cli <your-command-here>`.
  
### Linux / Mac
Ensure that you are using python 3.6 or later when running the commands below. You probably have other python versions installed on your system already.
 

  1. Download the latest release at https://github.com/eliasdoehne/stellaris-dashboard/releases
  1. Open a terminal in the extracted folder.
  2. (Optional but recommended) Create a virtual environment by running `python3.6 -m venv env`, and activate it by running `source env/bin/activate` whenever you want to use the dashboard. This avoids interference with any other python programs.
  3. Open a terminal in the downloaded directory and run `pip3.6 install -e .` to install the program and all dependencies using pip. The `-e` flag tells pip to link to the existing python code instead of copying it to another location, which makes editing your `config.ini` file easier.
  3. To use the interactive in-game dashboard, install the "Stellaris Dashboard Integration" mod. Do **either** of the following:
     1. Subscribe to the browser mod [in the Steam Workshop](http://steamcommunity.com/sharedfiles/filedetails/?id=1341242772) (maintained independently by Steam/reddit user 8igualdos0s)
     2. Or manually install it, it is included in the `mod` folder.
  4. Activate the mod in the Stellaris Launcher
  5. Run the program by activating your virtual environment if you made one (`source env/bin/activate`) and run `stellarisdashboard`
  6. Play the game

Note: You may have to use `python -m pip` instead of `pip` if you use Windows and follow the detailed instructions yourself. In this case, just replace `pip` with `python -m pip` wherever necessary.
If this is the case, then you probably also have to use `python -m stellarisdashboard` and `python -m stellarisdashboard.cli` instead of `stellarisdashboard` and `stellarisdashboardcli`.

# Instructions

If you just want the basics, run the `stellarisdashboard` command while you play the game and it should do everything for you: If you installed the program in step 3 above, run `stellarisdashboard` in your command line to launch the dashboard in default configuration or `stellarisdashboardcli` to execute specific commands, which are described below.

While `stellarisdashboard`  is running, you can open the in-game browser with the help button in the lower right corner of the game UI, or by pressing the shortcut Alt-B. Then, there should be a big button with the galaxy icon in the top right corner of the browser window. Clicking this button (or the shortcut "T") should open the dashboard. Alternatively, you can use your regular web browser to view the dashboard at [the default address](http://127.0.0.1/28053) without installing the mod.


## Command Line Interface

The command line interface allows you to:

  - Only run the save monitoring without any interactivity. This only builds the database, which you can later visualize (`stellarisdashboardcli monitor_saves`)
  - Produce the static visualizations (`stellarisdashboardcli visualize`)
  - Reparse all existing files. Running `stellarisdashboard` or `stellarisdashboardcli monitor_saves` will ignore any existing save files,
  so sometimes it may be necessary to manually re-parse them. (`stellarisdashboardcli parse_saves`)

Any parameters provided to these commands override the values set in the `config.ini` file.

## Configuration

The following parameters can be set in the `src/stellarisdashboard/config.ini` file:

  - `save_file_path`: The path where your save files are.
  - `base_output_path`: The path where any files generated by the dashboard are stored. This includes the database files and any images you generate with the `stellarisdashboardcli visualize` command.
  - `threads`: The number of concurrent processes that are used for reading save files. (Recommended: 2 or 3)
  - `colormap`: The colormap used when producing static images. A list of available values can be found here: https://matplotlib.org/examples/color/colormaps_reference.html
  - `port`:  The port where the interactive dashboard is served. If you change this, you should adapt the URL in the `mod/Timeline/interface/browser.gui` file accordingly.
  - `show_everything`: Set to `True` if you want to see the data of all empires.
  - `only_show_default_empires`: Set to `False` in combination with `show_everything=True` if you want to see data from Fallen and Awakened Empires 
  - `extract_system_ownership`: Set to `False` if you do not want to extract ownership data for the interactive galaxy map, as it is somewhat resource-intensive.
  
Note: Only the `config.ini` file that is in the same directory as the `config.py` will be used. If you installed the program using `pip install .` without the `-e` flag, then this will probably be somewhere else in a `..../site-packages/stellarisdashboard` folder or similar.

# Hardware Requirements

The Hardware requirements depend on several factors:

  - galaxy size
  - how fast you play / how much you pause the game. 
  - how frequently you generate autosaves

## CPU
If the dashboard cannot keep up, it may miss some data or certain events in the event ledger may be recorded incorrectly.

If you have a quad-core CPU or better, I suggest 2 threads. By default, the dashboard uses about half of the available threads.

If the dashboard cannot keep up, you can also reduce the Autosave frequency in the Stellaris options menu.

## Disk Space
The database should only require a few megabytes of space. Each game's data is stored in a separate database in your output folder, so you can delete them individually if you wish. 

The game continuously deletes the oldest autosave so only the most recent files are kept. If you plan a long game 
and want to be able to re-generate the database later, you need to continually backup the save files yourself.

This uses much more disk space for all the save files, but allows you to rebuild the full database at any point using 
`stellarisdashboardcli parse_saves --save-path path/to/your/save_backup`. 

# Known Issues

  1. Food budget numbers do not always match up (but should be reasonably close)
  2. Other budget items should be more correct, but I definitely do not take all modifiers into account. (Again, values should be close enough under most circumstances)
  3. Systems that are added to the map mid-game (e.g. precursor homeworlds) are currently not added to the database.
  4. Reloading old save files may or may not mess up the data base
    
## Contributions

If you want to compile the Cython extensions and run the (currently minimal) unittest suite, you should install Cython and pytest. You can do this by running `pip -r dev-requirements.txt`. 

**Contributions, suggestions and feature requests are appreciated!**

# Acknowledgements

Thanks to [this project](https://github.com/omiddavoodi/StellarisInGameLedger) by reddit user Ariestinak, which inspired the 
approach of modding the in-game browser.

Also thanks to reddit and Steam user 8igualdos0s for maintaining a copy of the browser mod [in the Steam Workshop.](http://steamcommunity.com/sharedfiles/filedetails/?id=1341242772)

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
